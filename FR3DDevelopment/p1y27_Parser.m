% 1-AA  2-CA  3-GA  4-UA  5-AC  6-CC  7-GC  8-UC 
% 9-AG 10-CG 11-GG 12-UG 13-AU 14-CU 15-GU 16-UU

clear Node
Filename = '1y27';

if exist('File'),
  [File,FIndex] = zAddNTData(Filename,0,File);
else
  [File,FIndex] = zAddNTData(Filename,0);
end

F = File(FIndex);

figure(1)
clf
zDisplayNT(F);

nMin = 1;
nMax = length(F.NT);

fprintf('Secondary structure with original interactions\n');
zSecondaryStructure(F,nMin,nMax);

% add a close cWW pair
F = pModifyEdge(F, '26(X)', '44(X)', 'cWW');

% remove interaction at the hairpin in loop 2:
F = pModifyEdge(F, '62(X)', '63(X)','');

% remove interactions at the junction for now:
F = pModifyEdge(F, '46(X)', '53(X)','');

% remove tertiary interactions we can't model:
F = pModifyEdge(F, '49(X)', '76(X)','');

% tertiary interactions between ends of the loops:
F = pModifyEdge(F, '33(X)', '66(X)','');
F = pModifyEdge(F, '34(X)', '65(X)','');
F = pModifyEdge(F, '35(X)', '64(X)','');
F = pModifyEdge(F, '37(X)', '61(X)','');
F = pModifyEdge(F, '38(X)', '60(X)','');

fprintf('Secondary structure with modified interactions\n');
zSecondaryStructure(F,nMin,nMax);

fprintf('Creating model nodes for this molecule\n');

Node = pMakeNodes(F,nMin,nMax);

break

Node(1).basehalfwidth = 20;

Node = pShiftNodeIndices(Node,nMin);

Node(21).subtype = 'XX';
Node(end).subtype = 'XXX';

Sequence = pReadFASTA('Purine_riboswitches.fasta',15,83);
Sequence = pSequenceConstraints(Node,Sequence);

Filename = 'Parser/Purine_riboswitches';

disp('Parsing')
numtodo = 100;
k = 1;

for j=k:min(length(Sequence),(k+numtodo-1)),
  [Node,Sequence] = pParseSequences(Node,Sequence,j,j);
  k = j;
  Sequence = pDisplayMultipleAlignment(Node,Sequence);
  drawnow
  save(Filename,'Node','Sequence','k');
end

break

%Sequence 1 took 0.232 min. Total 0.232 min, 0.232 per sequence. Memory   5.60 MB
%     00000001111111111112*22*2111111111111122222222222*333*22222222000000000
%     23456781223456789990*11*0998765432111122234567889*000*98876543888765432
%     (((((((((-(((((((--(*H-*)-))))))))---)---((((((-(*H--*)-))))))--)))))))  Log prob  Organism
%   1 GAUCAUAUAAUCGCGUGGAU*AU*GGCACGCAAGUUUCUACCGGGCACC*GUA*AAUGUCCGACUAUGGUC 1   -61.86   1y27 from 3D structure

%     00000000001111111111111112*22*2111111111111111222222222222*333*2222222220000000000
%     22233456781222234567899990*11*0999987654321111222345678889*000*9888765438888765432
%     (--(-(((((((---(((((((---(*H-*)---))))))))---)---((((((--(*H--*)--))))))---)))))))  Log prob  Organism
%   1 G--A-UCAUAUAA--UCGCGUGGA-U*AU*G--GCACGCAAGUUUCUACCGGGCAC-C*GUA*A-AUGUCCG-ACUAUGGUC 1   -61.86   1y27 from 3D structure
%   2 A--C-AUUCUUGUA-UAUGAUCAGUA*AU*A--UGGUCUGAU--UGU--UUCUACCUA*GUA*ACCGUAAAA-AACUAGACU 2   -81.00  Z99123.2/194901-195002
%   3 A--C-GACCUCAU--AUAAUCUU--G*GG*A---AUAUGGCCCAUAAG-UUUCUACCC*GGC*AACCGUAAAUUGCCGGACU 3   -80.56  J02732.1/196-297
%   4 A--C-GACCUCAU--AUAAUCUU--G*GG*A---AUAUGGCCCAUAAG-UUUCUACCC*GGC*AACCGUAAAUUGCCGGACU 4   -80.56  Z99107.2/86081-86182
%   5 G--A-ACACUCA---UAUAAUCGC-G*UG*G--AUAUGGCACGCAAG--UUUCUACCG*GGC*A-CCGUAAA-UGUCCGACU 5   -79.78  L77246.1/1237-1336
%   6 U--A--UCACUUG--UAUAACCUCAA*UA*AUAUGGUUUGAGGGUG---UCUACC--A*GGA*A-CCGUAAAAUCCUGA-UU 6   -78.69  D88802.1/12464-12365
%   7 A--C-GACCUCAU--AUAAUCUU--G*GG*A---AUAUGGCCCAUAAG-UUUCUACCC*GGC*AACCGUAAAUUGCCGGACU 7   -80.56  U51115.1/15589-15690
%   8 A--C-AUUCUUGUA-UAUGAUCAGUA*AU*A--UGGUCUGAU--UGU--UUCUACCUA*GUA*ACCGUAAAA-AACUAGACU 8   -81.00  D83026.1/18553-18452
%   9 U--A--UCACUUG--UAUAACCUCAA*UA*AUAUGGUUUGAGGGUG---UCUACC--A*GGA*A-CCGUAAAAUCCUGA-UU 9   -78.69  Z99107.2/14363-14264
%  10 A--U-GAA-UUC---GUAUAAUCG-C*GG*G--AAUAUGGCUCGCAAGUCUCUACCAA*GCU*ACCGUAAAUGGCU-UGACU 10   -82.29  U51115.1/11655-11756
%  11 G--A-ACACUCA---UAUAAUCGC-G*UG*G--AUAUGGCACGCAAG--UUUCUACCG*GGC*A-CCGUAAA-UGUCCGACU 11   -79.78  X83878.1/168-267
%  12 G--A-ACACUCA---UAUAAUCGC-G*UG*G--AUAUGGCACGCAAG--UUUCUACCG*GGC*A-CCGUAAA-UGUCCGACU 12   -79.78  Z99115.2/111605-111506
%  13 A--U-GAA-UUC---GUAUAAUCG-C*GG*G--AAUAUGGCUCGCAAGUCUCUACCAA*GCU*ACCGUAAAUGGCU-UGACU 13   -82.29  Z99107.2/82145-82246
%  14 G--U-UACCUCA---UAUAUACUC-G*AU*A---AUAUGGAUCGAGAG-UUUCUACCC*GGC*AACCUUAAAUUGCUGGACU 14   -79.56  AE017025.1/52387-52286
%  15 AA-GACCUCAUAUAAUCGCGGGGA-U*AU*G--GCCUGCAAG-UCU---CUACCU--A*ACG*A-CCGUUAUUCGUUAGACU 15   -81.01  AE017025.1/5362-5463
%  16 C--U-ACACUCAUA-UAAUCGCGG-G*GA*U---AUGGCCUGCAAGUU-UCUACCG-A*AGU*A-CCGUAAAUACUUUGACU 16   -81.87  AE017029.1/46768-46869
%  17 ACUG-CCUCAUAUA-AUCUUG----G*AG*A----UAAGGUCCAUAAG-UUUCUACCU*GGC*AACCAUGAAUUGCUAGACU 17   -79.41  AE017225.1/3605993-3605892
%  18 G--A-UCCUUCAU--AUAUCCUCA-A*UG*A--UAUGGUUUGAGAGUC-UCUACCG-G*GUU*A-CCGUAAACAACCUGACU 18   -77.17  AE016998.1/259601-259702
%  19 G--A-UCCUUCAU--AUAUCCUCA-A*AG*A--UAUGGUUUGAGAGUC-UCUACCG-G*GUU*A-CCGUAAACAACCUGACU 19   -77.17  AE017355.1/266577-266678
%  20 C--U-ACACUCAUA-UAAUCGCGG-G*GA*U---AUGGCCUGCAAGUU-UCUACCG-A*AGU*A-CCGUAAAUACUUUGACU 20   -81.87  AE017269.1/211313-211414
%  21 A--U-GCC-GUCGU-AUAAUAUC--G*GG*G---AUAUGGCCCGAAAGUUUCUACCUA*GCU*ACCGUAAAUGGCU-UGACU 21   -78.99  AE016998.1/261558-261659
%  22 C--U-ACACUCAUA-UAAUCGCGG-G*GA*U---AUGGCCUGCAAGUU-UCUACCG-A*AGU*A-CCGUAAAUACUUUGACU 22   -81.87  AE017002.1/301083-301184
%  23 C--U-ACACUCAUA-UAAUCGCGG-G*GA*U---AUGGCCUGCAAGUU-UCUACCG-A*AGU*A-CCGUAAAUACUUUGACU 23   -81.87  AE017334.2/1497694-1497795
%  24 G--U-UACCUCA---UAUAUACUC-G*AU*A---AUAUGGAUCGAGAG-UUUCUACCC*GGC*AACCUUAAAUUGCUGGACU 24   -79.56  AE017265.1/94745-94644
%  25 A--U-GCC-GUCGU-AUAAUAUC--G*GG*G---AUAUGGCCCGAAAGUUUCUACCUA*GCU*ACCGUAAAUGGCU-UGACU 25   -78.99  AE017265.1/8580-8681
%  26 A--U-GCC-GUCGU-AUAAUAUC--G*GG*G---AUAUGGCCCGAAAGUUUCUACCUA*GCU*ACCGUAAAUGGCU-UGACU 26   -78.99  AE017334.2/262601-262702
%  27 ACUG-CCUCAUAUA-AUCUUG----G*AG*A----UAAGGUCCAUAAG-UUUCUACCU*GGC*AACCAUGAAUUGCUAGACU 27   -79.41  AE017334.2/3605425-3605324
%  28 A--U-GCC-GUCGU-AUAAUAUC--G*GG*G---AUAUGGCCCGAAAGUUUCUACCUA*GCU*ACCGUAAAUGGCU-UGACU 28   -78.99  AE017225.1/262614-262715
%  29 AA-GACCUCAUAUAAUCGCGGGGA-U*AU*G--GCCUGCAAG-UCU---CUACCU--A*ACG*A-CCGUUAUUCGUUAGACU 29   -81.01  AY224385.1/13434-13535
%  30 C--U-ACACUCAUA-UAAUCGCGG-G*GA*U---AUGGCCUGCAAGUU-UCUACCG-A*AGU*A-CCGUAAAUACUUUGACU 30   -81.87  AE017355.1/1521880-1521981
%  31 A--U-GCC-GUCGU-AUAAUAUC--G*GG*G---AUAUGGCCCGAAAGUUUCUACCUA*GCU*ACCGUAAAUGGCU-UGACU 31   -78.99  AE017355.1/268537-268638